   Compiling sim3d v0.1.0 (/Users/simonheikkila/Documents/antigravity-dev/goldrush-sluice-3d/crates/sim3d)
warning: unused imports: `apic_d_inverse`, `quadratic_bspline_1d`, and `quadratic_bspline`
  --> crates/sim/src/flip/mod.rs:30:19
   |
30 | use crate::grid::{apic_d_inverse, quadratic_bspline, quadratic_bspline_1d, CellType, Grid};
   |                   ^^^^^^^^^^^^^^  ^^^^^^^^^^^^^^^^^  ^^^^^^^^^^^^^^^^^^^^
   |
   = note: `#[warn(unused_imports)]` (part of `#[warn(unused)]`) on by default

warning: unused import: `Mat2`
  --> crates/sim/src/flip/mod.rs:33:12
   |
33 | use glam::{Mat2, Vec2};
   |            ^^^^

warning: unused imports: `CellType` and `Grid`
 --> crates/sim/src/grid/extrapolation.rs:7:13
  |
7 | use super::{CellType, Grid};
  |             ^^^^^^^^  ^^^^

warning: unused imports: `CellType` and `Grid`
 --> crates/sim/src/grid/pressure.rs:7:13
  |
7 | use super::{CellType, Grid};
  |             ^^^^^^^^  ^^^^

warning: unused variable: `div_after`
   --> crates/sim/src/flip/mod.rs:235:13
    |
235 |         let div_after = self.grid.total_divergence();
    |             ^^^^^^^^^
    |
    = note: `#[warn(unused_variables)]` (part of `#[warn(unused)]`) on by default
help: if this is intentional, prefix it with an underscore
    |
235 |         let _div_after = self.grid.total_divergence();
    |             +
help: you might have meant to pattern match on the similarly named constant `VORTICITY_EPSILON`
    |
235 -         let div_after = self.grid.total_divergence();
235 +         let pbf::VORTICITY_EPSILON = self.grid.total_divergence();
    |

warning: unused variable: `dt`
    --> crates/sim/src/flip/mod.rs:1262:67
     |
1262 |     fn resolve_clump_floor_collision(&mut self, clump_idx: usize, dt: f32) {
     |                                                                   ^^
     |
help: if this is intentional, prefix it with an underscore
     |
1262 |     fn resolve_clump_floor_collision(&mut self, clump_idx: usize, _dt: f32) {
     |                                                                   +
help: you might have meant to pattern match on the similarly named constant `VORTICITY_EPSILON`
     |
1262 -     fn resolve_clump_floor_collision(&mut self, clump_idx: usize, dt: f32) {
1262 +     fn resolve_clump_floor_collision(&mut self, clump_idx: usize, pbf::VORTICITY_EPSILON: f32) {
     |

warning: unused variable: `name`
    --> crates/sim/src/flip/mod.rs:1501:36
     |
1501 |         let measure = |sim: &Self, name: &'static str| -> f32 {
     |                                    ^^^^ help: if this is intentional, prefix it with an underscore: `_name`

warning: unused variable: `width`
   --> crates/sim/src/dem.rs:189:13
    |
189 |         let width = grid.width;
    |             ^^^^^
    |
help: if this is intentional, prefix it with an underscore
    |
189 |         let _width = grid.width;
    |             +
help: you might have meant to pattern match on the similarly named constant `MAX_PARTICLES`
    |
189 -         let width = grid.width;
189 +         let pbf::MAX_PARTICLES = grid.width;
    |

warning: unused variable: `height`
   --> crates/sim/src/dem.rs:190:13
    |
190 |         let height = grid.height;
    |             ^^^^^^
    |
help: if this is intentional, prefix it with an underscore
    |
190 |         let _height = grid.height;
    |             +
help: you might have meant to pattern match on the similarly named constant `MAX_PARTICLES`
    |
190 -         let height = grid.height;
190 +         let pbf::MAX_PARTICLES = grid.height;
    |

warning: unused variable: `contact_dist_sq`
   --> crates/sim/src/dem.rs:193:13
    |
193 |         let contact_dist_sq = contact_dist * contact_dist;
    |             ^^^^^^^^^^^^^^^
    |
help: if this is intentional, prefix it with an underscore
    |
193 |         let _contact_dist_sq = contact_dist * contact_dist;
    |             +
help: you might have meant to pattern match on the similarly named constant `VORTICITY_EPSILON`
    |
193 -         let contact_dist_sq = contact_dist * contact_dist;
193 +         let pbf::VORTICITY_EPSILON = contact_dist * contact_dist;
    |

warning: field `near_force_buffer` is never read
  --> crates/sim/src/flip/mod.rs:58:5
   |
38 | pub struct FlipSimulation {
   |            -------------- field in this struct
...
58 |     near_force_buffer: Vec<Vec2>,
   |     ^^^^^^^^^^^^^^^^^
   |
   = note: `#[warn(dead_code)]` (part of `#[warn(unused)]`) on by default

warning: multiple methods are never used
   --> crates/sim/src/flip/mod.rs:742:8
    |
122 | impl FlipSimulation {
    | ------------------- methods in this implementation
...
742 |     fn apply_sediment_forces(&mut self, dt: f32) {
    |        ^^^^^^^^^^^^^^^^^^^^^
...
762 |     fn deposit_settled_sediment(&mut self, dt: f32) {
    |        ^^^^^^^^^^^^^^^^^^^^^^^^
...
776 |     fn entrain_deposited_sediment(&mut self, dt: f32) {
    |        ^^^^^^^^^^^^^^^^^^^^^^^^^^
...
786 |     fn collapse_deposited_sediment(&mut self) {
    |        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
...
791 |     fn count_column_deposited(&self, i: usize) -> usize {
    |        ^^^^^^^^^^^^^^^^^^^^^^
...
796 |     fn find_top_deposited_in_column(&self, i: usize) -> Option<usize> {
    |        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
...
801 |     fn find_landing_j(&self, i: usize) -> usize {
    |        ^^^^^^^^^^^^^^
...
815 |     fn update_particle_states(&mut self, dt: f32) {
    |        ^^^^^^^^^^^^^^^^^^^^^^
...
824 |     fn compute_pile_heightfield(&mut self) {
    |        ^^^^^^^^^^^^^^^^^^^^^^^^
...
866 |     fn enforce_pile_constraints(&mut self) {
    |        ^^^^^^^^^^^^^^^^^^^^^^^^
...
921 |     fn push_particles_apart(&mut self, iterations: usize) {
    |        ^^^^^^^^^^^^^^^^^^^^
...
939 |     fn compute_water_neighbor_counts(&mut self) {
    |        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

warning: methods `mark_fluid_faces_known`, `extrapolate_u_layer`, `extrapolate_v_layer`, and `mg_smooth_jacobi` are never used
    --> crates/sim/src/grid/mod.rs:996:8
     |
 233 | impl Grid {
     | --------- methods in this implementation
...
 996 |     fn mark_fluid_faces_known(&self, u_known: &mut [bool], v_known: &mut [bool]) {
     |        ^^^^^^^^^^^^^^^^^^^^^^
...
1031 |     fn extrapolate_u_layer(&mut self, u_known: &mut [bool]) {
     |        ^^^^^^^^^^^^^^^^^^^
...
1109 |     fn extrapolate_v_layer(&mut self, v_known: &mut [bool]) {
     |        ^^^^^^^^^^^^^^^^^^^
...
1676 |     fn mg_smooth_jacobi(&mut self, level: usize, iterations: usize) {
     |        ^^^^^^^^^^^^^^^^

warning: variable `N` should have a snake case name
   --> crates/sim/src/pbf.rs:324:21
    |
324 |                 let N = grad_mag_omega / len_sq.sqrt();
    |                     ^ help: convert the identifier to snake case: `n`
    |
    = note: `#[warn(non_snake_case)]` (part of `#[warn(nonstandard_style)]`) on by default

warning: `sim` (lib) generated 14 warnings (run `cargo fix --lib -p sim` to apply 9 suggestions)
warning: unused variable: `had_water`
   --> crates/sim3d/src/world.rs:395:21
    |
395 |                 let had_water = self.water_surface[idx] > ground_before + 1e-4;
    |                     ^^^^^^^^^ help: if this is intentional, prefix it with an underscore: `_had_water`
    |
    = note: `#[warn(unused_variables)]` (part of `#[warn(unused)]`) on by default

warning: value assigned to `remaining_dig` is never read
   --> crates/sim3d/src/world.rs:433:21
    |
433 |                     remaining_dig -= dug;
    |                     ^^^^^^^^^^^^^
    |
    = help: maybe it is overwritten before being read?
    = note: `#[warn(unused_assignments)]` (part of `#[warn(unused)]`) on by default

   Compiling game v0.1.0 (/Users/simonheikkila/Documents/antigravity-dev/goldrush-sluice-3d/crates/game)
warning: unused variable: `collapse_layout`
   --> crates/game/src/gpu/heightfield.rs:286:13
    |
286 |         let collapse_layout = device.create_bind_group_layout(&wgpu::BindGroupLayoutDescriptor {
    |             ^^^^^^^^^^^^^^^ help: if this is intentional, prefix it with an underscore: `_collapse_layout`
    |
    = note: `#[warn(unused_variables)]` (part of `#[warn(unused)]`) on by default

warning: unused variable: `iter`
    --> crates/game/src/gpu/mgpcg.rs:1598:13
     |
1598 |         for iter in 0..max_iterations {
     |             ^^^^ help: if this is intentional, prefix it with an underscore: `_iter`

warning: unused variable: `queue`
  --> crates/game/src/gpu/p2g.rs:87:9
   |
87 |         queue: &wgpu::Queue,
   |         ^^^^^ help: if this is intentional, prefix it with an underscore: `_queue`

warning: unused variable: `base_particle_size`
   --> crates/game/src/gpu/renderer.rs:267:9
    |
267 |         base_particle_size: f32,
    |         ^^^^^^^^^^^^^^^^^^
    |
help: if this is intentional, prefix it with an underscore
    |
267 |         _base_particle_size: f32,
    |         +
help: you might have meant to pattern match on the similarly named constant `SCALE`
    |
267 -         base_particle_size: f32,
267 +         gpu::p2g_3d::SCALE: f32,
    |

warning: fields `bed_flux_x_buffer`, `bed_flux_z_buffer`, and `bed_desired_delta_buffer` are never read
   --> crates/game/src/gpu/bed_3d.rs:128:5
    |
119 | pub struct GpuBed3D {
    |            -------- fields in this struct
...
128 |     bed_flux_x_buffer: wgpu::Buffer,
    |     ^^^^^^^^^^^^^^^^^
129 |     bed_flux_z_buffer: wgpu::Buffer,
    |     ^^^^^^^^^^^^^^^^^
130 |     bed_desired_delta_buffer: wgpu::Buffer,
    |     ^^^^^^^^^^^^^^^^^^^^^^^^
    |
    = note: `#[warn(dead_code)]` (part of `#[warn(unused)]`) on by default

warning: multiple fields are never read
   --> crates/game/src/gpu/flip_3d.rs:468:5
    |
423 | pub struct GpuFlip3D {
    |            --------- fields in this struct
...
468 |     vorticity_x_buffer: wgpu::Buffer,
    |     ^^^^^^^^^^^^^^^^^^
469 |     vorticity_y_buffer: wgpu::Buffer,
    |     ^^^^^^^^^^^^^^^^^^
470 |     vorticity_z_buffer: wgpu::Buffer,
    |     ^^^^^^^^^^^^^^^^^^
471 |     vorticity_mag_buffer: wgpu::Buffer,
    |     ^^^^^^^^^^^^^^^^^^^^
...
482 |     sediment_fraction_buffer: wgpu::Buffer,
    |     ^^^^^^^^^^^^^^^^^^^^^^^^
...
488 |     sediment_pressure_buffer: wgpu::Buffer,
    |     ^^^^^^^^^^^^^^^^^^^^^^^^
...
521 |     position_delta_x_buffer: wgpu::Buffer,  // Grid-based delta X
    |     ^^^^^^^^^^^^^^^^^^^^^^^
522 |     position_delta_y_buffer: wgpu::Buffer,  // Grid-based delta Y
    |     ^^^^^^^^^^^^^^^^^^^^^^^
523 |     position_delta_z_buffer: wgpu::Buffer,  // Grid-based delta Z
    |     ^^^^^^^^^^^^^^^^^^^^^^^
...
532 |     sediment_density_error_pipeline: wgpu::ComputePipeline,
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
533 |     sediment_density_error_bind_group: wgpu::BindGroup,
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
534 |     sediment_density_correct_pipeline: wgpu::ComputePipeline,
    |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

warning: field `max_particles` is never read
  --> crates/game/src/gpu/g2p.rs:62:5
   |
33 | pub struct GpuG2pSolver {
   |            ------------ field in this struct
...
62 |     max_particles: usize,
   |     ^^^^^^^^^^^^^

warning: field `densities_buffer` is never read
  --> crates/game/src/gpu/g2p_3d.rs:85:5
   |
77 | pub struct GpuG2p3D {
   |            -------- field in this struct
...
85 |     densities_buffer: Arc<wgpu::Buffer>,
   |     ^^^^^^^^^^^^^^^^

warning: constant `SCALE` is never used
  --> crates/game/src/gpu/p2g.rs:16:7
   |
16 | const SCALE: f32 = 1_000_000.0;
   |       ^^^^^

warning: fields `scatter_bind_group_layout`, `divide_bind_group_layout`, `max_particles`, `divide_workgroup_x`, and `divide_workgroup_y` are never read
  --> crates/game/src/gpu/p2g.rs:62:5
   |
29 | pub struct GpuP2gSolver {
   |            ------------ fields in this struct
...
62 |     scatter_bind_group_layout: wgpu::BindGroupLayout,
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^
63 |     divide_bind_group_layout: wgpu::BindGroupLayout,
   |     ^^^^^^^^^^^^^^^^^^^^^^^^
...
68 |     max_particles: usize,
   |     ^^^^^^^^^^^^^
...
72 |     divide_workgroup_x: u32,
   |     ^^^^^^^^^^^^^^^^^^
73 |     divide_workgroup_y: u32,
   |     ^^^^^^^^^^^^^^^^^^

warning: fields `divergence_staging` and `cell_type_staging` are never read
  --> crates/game/src/gpu/pressure.rs:28:5
   |
16 | pub struct GpuPressureSolver {
   |            ----------------- fields in this struct
...
28 |     divergence_staging: wgpu::Buffer,
   |     ^^^^^^^^^^^^^^^^^^
29 |     cell_type_staging: wgpu::Buffer,
   |     ^^^^^^^^^^^^^^^^^

warning: `sim3d` (lib) generated 2 warnings
warning: `game` (lib) generated 11 warnings (run `cargo fix --lib -p game` to apply 1 suggestion)
warning: unused variable: `gpu`
   --> crates/game/examples/detail_zone.rs:632:21
    |
632 |         if let Some(gpu) = &mut self.gpu {
    |                     ^^^ help: if this is intentional, prefix it with an underscore: `_gpu`
    |
    = note: `#[warn(unused_variables)]` (part of `#[warn(unused)]`) on by default

warning: struct `Mesh` is never constructed
  --> crates/game/examples/detail_zone.rs:64:8
   |
64 | struct Mesh {
   |        ^^^^
   |
   = note: `#[warn(dead_code)]` (part of `#[warn(unused)]`) on by default

warning: associated items `new`, `update`, `create_vertex_buffer`, and `create_index_buffer` are never used
   --> crates/game/examples/detail_zone.rs:73:8
    |
 72 | impl Mesh {
    | --------- associated items in this implementation
 73 |     fn new(device: &wgpu::Device, vertices: &[WorldVertex], indices: &[u32], label: &str) -> Self {
    |        ^^^
...
 86 |     fn update(
    |        ^^^^^^
...
117 |     fn create_vertex_buffer(
    |        ^^^^^^^^^^^^^^^^^^^^
...
144 |     fn create_index_buffer(
    |        ^^^^^^^^^^^^^^^^^^^

warning: field `pipeline` is never read
   --> crates/game/examples/detail_zone.rs:223:5
    |
218 | struct GpuState {
    |        -------- field in this struct
...
223 |     pipeline: wgpu::RenderPipeline,
    |     ^^^^^^^^

warning: function `build_terrain_mesh` is never used
    --> crates/game/examples/detail_zone.rs:1359:4
     |
1359 | fn build_terrain_mesh(world: &World) -> (Vec<WorldVertex>, Vec<u32>) {
     |    ^^^^^^^^^^^^^^^^^^

warning: function `build_water_mesh` is never used
    --> crates/game/examples/detail_zone.rs:1479:4
     |
1479 | fn build_water_mesh(world: &World) -> (Vec<WorldVertex>, Vec<u32>) {
     |    ^^^^^^^^^^^^^^^^

warning: `game` (example "detail_zone") generated 6 warnings
    Finished `release` profile [optimized] target(s) in 13.30s
     Running `target/release/examples/detail_zone`
=== DETAIL ZONE: FLIP + Heightfield ===
FLIP grid: 64x32x64 at 1.0m
Press 1 to spawn water
GpuFlip3D initialized
Heightfield water: 865.58, sediment: 15.85 | FLIP particles: 0
Heightfield water: 862.94, sediment: 28.60 | FLIP particles: 0
Heightfield water: 861.12, sediment: 38.43 | FLIP particles: 0
Heightfield water: 860.09, sediment: 46.87 | FLIP particles: 0
Heightfield water: 859.51, sediment: 55.58 | FLIP particles: 0
