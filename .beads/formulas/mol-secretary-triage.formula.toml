description = """
Async mail triage for the Mayor.

The Secretary buffers the Mayor's inbox so they can stay focused mid-task.
This loop classifies incoming mail by urgency, escalates true interrupts,
and batches non-critical updates into a scheduled digest.

Key principles:
- Interrupt only for real blockers
- Batch everything else
- Archive after processing
"""
formula = "mol-secretary-triage"
version = 1

[[steps]]
id = "inbox-check"
title = "Collect incoming mail"
description = """
Gather all new messages that need triage.

Primary inbox: Mayor (you triage on their behalf).
Optional inbox: Secretary (if senders route updates directly).

```bash
# Mayor inbox (primary)
gt mail inbox mayor --json

# Secretary inbox (optional)
gt mail inbox secretary --json
```

If no new messages, end the cycle.
"""

[[steps]]
id = "classify"
title = "Classify by urgency"
needs = ["inbox-check"]
description = """
Read each message and classify into one of three categories:

1. INTERRUPT (Immediate)
   - Blocking incidents, outages, security issues
   - Anything that will stall multiple agents right now
   - Explicit subject tags: URGENT, BLOCKER, P0

2. TIME-SENSITIVE (Next digest, highlighted)
   - Deadlines within 24 hours
   - Decisions needed today

3. ROUTINE (Batch)
   - FYI updates, status reports, low-priority notes

Default to LESS urgency. If unsure, do not interrupt.

```bash
# For each message:
gt mail read <id>
```

Build three lists: interrupts, time-sensitive, routine.
"""

[[steps]]
id = "send-interrupts"
title = "Escalate true interrupts"
needs = ["classify"]
description = """
For each INTERRUPT item, send a concise escalation to the Mayor.
Include: subject, sender, why it is urgent, and the specific action needed.

```bash
gt mail send mayor/ -s "INTERRUPT: <subject>" -m "From: <sender>
Reason: <why urgent>
Action needed: <what to decide/do>
Message id: <id>"
```

Archive the original message after sending.
"""

[[steps]]
id = "send-digest"
title = "Batch non-critical updates"
needs = ["send-interrupts"]
description = """
If there are TIME-SENSITIVE or ROUTINE items, send a single digest to the Mayor.
Highlight time-sensitive items at the top with deadlines.

```bash
gt mail send mayor/ -s "Secretary Digest: <date>" -m "Time-sensitive (action today):
- <summary> (from <sender>, deadline <time>)

Routine updates:
- <summary> (from <sender>)
"
```

Archive all messages included in the digest.
"""

[[steps]]
id = "cleanup"
title = "Inbox hygiene"
needs = ["send-digest"]
description = """
Ensure inbox hygiene after triage.

```bash
# Archive processed messages
gt mail archive <id>
```

Leave only items that are genuinely unprocessed or awaiting clarification.
"""

[[steps]]
id = "loop-or-exit"
title = "End cycle"
needs = ["cleanup"]
description = """
If running a continuous patrol, squash the wisp and start a new one:

```bash
bd mol squash <wisp-id> --summary "Triage complete: <counts>"
bd mol wisp create mol-secretary-triage
bd update <wisp-id> --status=hooked --assignee=secretary
```

If not looping, exit after cleanup.
"""
