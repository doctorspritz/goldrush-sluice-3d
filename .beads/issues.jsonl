{"id":"sluice-2z8","title":"Deposition suppression too aggressive in shallow water","description":"## Problem\nDeposition is overly suppressed in shallow water conditions, preventing natural sediment accumulation even when flow velocity is low.\n\n## Location\n`crates/sim3d/src/world.rs` - deposition calculation\n\n## Impact\nUnrealistic sediment transport, gold doesn't settle in shallows.\n\n## Solution\nReview deposition threshold and shallow water handling.","status":"open","priority":2,"issue_type":"bug","owner":"simon.heikkila@gmail.com","created_at":"2026-01-19T18:35:01.475334+10:00","created_by":"doctorspritz","updated_at":"2026-01-19T18:35:01.475334+10:00"}
{"id":"sluice-42e","title":"Fixed-point atomic overflow risk in P2G scatter","description":"## Problem\nIn `p2g_scatter_3d.wgsl`, fixed-point atomics use SCALE=1,000,000 with i32 max ~2.1e9. With high particle counts (100k+) accumulating in single cells, overflow is possible.\n\n## Location\n`crates/game/src/gpu/shaders/p2g_scatter_3d.wgsl`\n\n## Risk\nSilent data corruption, unstable simulation.\n\n## Solution\nUse i64 atomics or reduce SCALE factor with saturation checks.","status":"open","priority":1,"issue_type":"bug","owner":"simon.heikkila@gmail.com","created_at":"2026-01-19T18:34:30.61681+10:00","created_by":"doctorspritz","updated_at":"2026-01-19T18:34:30.61681+10:00"}
{"id":"sluice-59h","title":"Replace linked-list spatial hash","description":"Use prefix-sum dense array instead of linked-list. 15-20% speedup expected.","status":"open","priority":2,"issue_type":"task","owner":"simon.heikkila@gmail.com","created_at":"2026-01-19T18:15:23.790013+10:00","created_by":"doctorspritz","updated_at":"2026-01-19T18:15:23.790013+10:00"}
{"id":"sluice-6cp","title":"Missing architecture documentation","description":"## Problem\nNo high-level architecture overview. New developers cannot understand system structure. Missing documentation for:\n- GPU pipeline stages\n- Data flow between CPU/GPU\n- Shader organization\n- Sediment physics model\n\n## Solution\nCreate docs/ARCHITECTURE.md with diagrams and explanations.","status":"open","priority":2,"issue_type":"task","owner":"simon.heikkila@gmail.com","created_at":"2026-01-19T18:35:00.907694+10:00","created_by":"doctorspritz","updated_at":"2026-01-19T18:35:00.907694+10:00"}
{"id":"sluice-7al","title":"GPU/CPU state divergence in async readback","description":"## Problem\nAsync GPU readback with double-buffered slots can leave CPU state stale for 2+ frames. If GPU fails to signal completion, CPU may read garbage or outdated data.\n\n## Location\n`crates/game/src/gpu/flip_3d.rs` - ReadbackSlot logic\n\n## Risk\nCorrupted particle data, physics glitches.\n\n## Solution\nAdd fence synchronization or timeout detection with graceful degradation.","status":"open","priority":1,"issue_type":"bug","owner":"simon.heikkila@gmail.com","created_at":"2026-01-19T18:34:31.156177+10:00","created_by":"doctorspritz","updated_at":"2026-01-19T18:34:31.156177+10:00"}
{"id":"sluice-7k2","title":"rand_float() race condition with unsafe static mut","description":"## Problem\n`rand_float()` uses unsafe static mutable SEED. This is undefined behavior if called from multiple threads, and fragile even in single-threaded code.\n\n## Location\n`crates/game/src/main.rs` lines 1585-1591\n\n## Solution\nUse `fastrand` crate or `thread_local!` with Cell. This duplicates todo 037 but records it in beads.","status":"open","priority":1,"issue_type":"bug","owner":"simon.heikkila@gmail.com","created_at":"2026-01-19T18:34:31.718722+10:00","created_by":"doctorspritz","updated_at":"2026-01-19T18:34:31.718722+10:00"}
{"id":"sluice-7or","title":"Test coverage at 40% - critical paths untested","description":"## Problem\nOverall test coverage is ~40%. 80% of public functions lack tests. No property-based testing for physics invariants.\n\n## Critical gaps\n- P2G/G2P shader logic\n- Pressure solver convergence\n- Sediment transport physics\n- Async readback paths\n\n## Solution\nAdd unit tests for critical paths, consider proptest for physics.","status":"open","priority":2,"issue_type":"task","owner":"simon.heikkila@gmail.com","created_at":"2026-01-19T18:35:00.32992+10:00","created_by":"doctorspritz","updated_at":"2026-01-19T18:35:00.32992+10:00"}
{"id":"sluice-7z1","title":"NaN propagation risk in velocity normalization","description":"## Problem\nDivision by weight sum in G2P can produce NaN if weight is zero. NaN then propagates through simulation corrupting all data.\n\n## Location\n`crates/game/src/gpu/shaders/g2p_3d.wgsl`\n\n## Solution\nAdd epsilon to denominator or skip update when weight \u003c epsilon.","status":"open","priority":2,"issue_type":"bug","owner":"simon.heikkila@gmail.com","created_at":"2026-01-19T18:34:59.214568+10:00","created_by":"doctorspritz","updated_at":"2026-01-19T18:34:59.214568+10:00"}
{"id":"sluice-9v0","title":"Merge DFSPH into sim crate","description":"Consolidate DFSPH into main simulation crate.","status":"open","priority":2,"issue_type":"task","owner":"simon.heikkila@gmail.com","created_at":"2026-01-19T18:15:34.267015+10:00","created_by":"doctorspritz","updated_at":"2026-01-19T18:15:34.267015+10:00"}
{"id":"sluice-aru","title":"Pressure gradient zeros at riffle faces","description":"Pressure solver does not correctly handle gradients at fluid-solid boundaries.","status":"open","priority":1,"issue_type":"bug","owner":"simon.heikkila@gmail.com","created_at":"2026-01-19T18:15:22.443914+10:00","created_by":"doctorspritz","updated_at":"2026-01-19T18:15:22.443914+10:00"}
{"id":"sluice-b3g","title":"Water spawns at exact riffle top height","description":"Water particles spawn at y=0.44m, same height as first riffle top. Geometrically impossible for water to overflow.","status":"open","priority":1,"issue_type":"bug","owner":"simon.heikkila@gmail.com","created_at":"2026-01-19T18:15:13.306122+10:00","created_by":"doctorspritz","updated_at":"2026-01-19T18:15:13.306122+10:00"}
{"id":"sluice-b7y","title":"Double-free risk in ReadbackSlot::try_read()","description":"## Problem\nIf `try_read()` is called twice before new data is written, it may return the same buffer twice or trigger use-after-free if buffer is recycled.\n\n## Location\n`crates/game/src/gpu/flip_3d.rs` - ReadbackSlot implementation\n\n## Risk\nMemory corruption, undefined behavior.\n\n## Solution\nAdd consumed flag or use Option\u003cT\u003e to ensure single consumption.","status":"open","priority":1,"issue_type":"bug","owner":"simon.heikkila@gmail.com","created_at":"2026-01-19T18:34:32.279762+10:00","created_by":"doctorspritz","updated_at":"2026-01-19T18:34:32.279762+10:00"}
{"id":"sluice-bxk","title":"Zero cell size divide-by-zero in grid initialization","description":"## Problem\nIf cell_size is accidentally set to 0, multiple divisions will cause panic or infinity values.\n\n## Location\nGrid initialization in various modules\n\n## Solution\nValidate cell_size \u003e 0 at construction time with descriptive error.","status":"open","priority":2,"issue_type":"bug","owner":"simon.heikkila@gmail.com","created_at":"2026-01-19T18:34:59.776494+10:00","created_by":"doctorspritz","updated_at":"2026-01-19T18:34:59.776494+10:00"}
{"id":"sluice-dd8","title":"CFL violation - particles travel 2 cells/step","description":"CFL ~2.0, should be \u003c1.0. Fix with smaller timestep or sub-stepping.","status":"open","priority":3,"issue_type":"task","owner":"simon.heikkila@gmail.com","created_at":"2026-01-19T18:15:35.588921+10:00","created_by":"doctorspritz","updated_at":"2026-01-19T18:15:35.588921+10:00"}
{"id":"sluice-don","title":"Implement velocity extrapolation (honey-water fix)","description":"Critical fix for honey-water behavior. ~2% momentum loss per frame at fluid boundaries. Tests written in crates/sim/tests/velocity_extrapolation_tests.rs. See plans/velocity-extrapolation-implementation.md for detailed pseudocode.","status":"in_progress","priority":0,"issue_type":"bug","owner":"simon.heikkila@gmail.com","created_at":"2026-01-19T18:04:17.20507+10:00","created_by":"doctorspritz","updated_at":"2026-01-19T18:07:50.09932+10:00"}
{"id":"sluice-hyp","title":"Fix gaps in deposited piles","description":"DEM settling produces piles with occasional holes. Polish issue.","status":"open","priority":3,"issue_type":"bug","owner":"simon.heikkila@gmail.com","created_at":"2026-01-19T18:15:34.920628+10:00","created_by":"doctorspritz","updated_at":"2026-01-19T18:15:34.920628+10:00"}
{"id":"sluice-jaz","title":"GPU-CPU roundtrip inefficiency","description":"Grid velocities round-trip through CPU. Wastes 290KB/frame. Share buffers between P2G and G2P.","status":"open","priority":2,"issue_type":"task","owner":"simon.heikkila@gmail.com","created_at":"2026-01-19T18:15:23.119341+10:00","created_by":"doctorspritz","updated_at":"2026-01-19T18:15:23.119341+10:00"}
{"id":"sluice-tem","title":"Consider SoA particle layout","description":"64-byte struct but most loops need 16 bytes. Defer until 100K+ particles.","status":"open","priority":2,"issue_type":"task","owner":"simon.heikkila@gmail.com","created_at":"2026-01-19T18:15:24.461247+10:00","created_by":"doctorspritz","updated_at":"2026-01-19T18:15:24.461247+10:00"}
{"id":"sluice-thw","title":"Sediment settling velocity scaling error (~18x amplification)","description":"## Problem\nSettling velocity calculation has incorrect scaling. For gold particles (density 19300 kg/mÂ³), the current formula produces ~18x amplification versus physical reality.\n\n## Location\n`crates/sim3d/src/world.rs` - settling velocity calculation\n\n## Impact\nGold settles unrealistically fast, affecting gameplay balance.\n\n## Solution\nReview Stokes law implementation and unit conversions.","status":"open","priority":2,"issue_type":"bug","owner":"simon.heikkila@gmail.com","created_at":"2026-01-19T18:34:58.643902+10:00","created_by":"doctorspritz","updated_at":"2026-01-19T18:34:58.643902+10:00"}
{"id":"sluice-u3f","title":"Sediment particle index corruption after swap_remove","description":"## Problem\nWhen particles are removed via `swap_remove`, the index of the swapped particle changes but references in sediment mapping may not be updated.\n\n## Location\n`crates/game/src/main.rs` line 779 area - sediment particle management\n\n## Risk\nWrong particles receive sediment, physics corruption.\n\n## Solution\nUse stable indices (arena/generational) or update all references after swap.","status":"open","priority":1,"issue_type":"bug","owner":"simon.heikkila@gmail.com","created_at":"2026-01-19T18:34:32.834357+10:00","created_by":"doctorspritz","updated_at":"2026-01-19T18:34:32.834357+10:00"}
